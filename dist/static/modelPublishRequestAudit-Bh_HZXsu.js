import{d as O,a as S,u as U,r as v,l as J,b as c,o as _,n as k,f as $,c as t,w as o,i as d,F as x,A as T,e as y,t as B,s as A,j as h,x as b,E as n}from"./index-BeHN7UMk.js";import{l as G}from"./constant-CsPomWco.js";const H=$("div",{class:"shadow-border title-container"},"模型审核",-1),K={class:"table-container"},Q={class:"button-container"},Z=O({__name:"modelPublishRequestAudit",setup(W){const g=S([]),p=U(),I=v(""),M=v([]),w=v([]),E=a=>{let l=JSON.parse(a.model_info);console.log("showModelInfo objects: ",l);let e=l.nodeList.nodes;console.log("------",e);let r=l.modelConfig.modules;I.value=a.model_name,M.value=r,w.value.length=0,e.forEach(m=>{let f={模块名:"",算法:""};f.模块名=m.nodeInfo.label,f.算法=G[m.nodeInfo.use_algorithm],w.value.push(f)})},C=()=>{h.get("administration/fetch_publish_model_applications/").then(a=>{if(a.data.code==401)b.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:()=>{p.push("/")}});else if(a.data.code==200){let l=a.data.data;g.length=0;for(let e of l)g.push({...e})}else n.error("获取发布模型申请失败，"+a.data.message)}).catch(()=>{n.error("获取发布模型申请失败，请稍后重试")})};J(()=>{C()});const R=(a,l)=>{h.get("administration/delete_publish_model_applications/?applicationId="+l.id).then(e=>{e.data.code==401?b.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:()=>{p.push("/")}}):e.data.code==200?a!==-1&&g.splice(a,1):n.error("删除发布模型申请失败，"+e.data.message)}).catch(()=>{n.error("删除发布模型申请失败，请稍后重试")})},j=(a,l)=>{h.get("administration/handle_publish_model_request/?applicationId="+l.id+"&status=审核通过").then(e=>{e.data.code==200?(n.success("发布模型申请审核通过"),C()):e.data.code==401?b.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:()=>{p.push("/")}}):n.error("发布模型申请审核失败，"+e.data.message)}).catch(()=>{n.error("发布模型申请审核失败，请稍后重试")})},q=(a,l)=>{h.get("administration/handle_publish_model_request/?applicationId="+l.id+"&status=审核不通过").then(e=>{e.data.code==200?(n.success("发布模型申请审核不通过"),C()):e.data.code==401?b.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:()=>{p.push("/")}}):n.error("发布模型申请审核失败，"+e.data.message)}).catch(()=>{n.error("发布模型申请审核失败，请稍后重试")})},z=a=>{h.get(`fetch_model_report/?modelId=${a}`,{responseType:"blob"}).then(l=>{if(l.status===200){const e=window.URL.createObjectURL(new Blob([l.data])),r=document.createElement("a");r.href=e,r.setAttribute("download",`report_${a}.pdf`),document.body.appendChild(r),r.click()}else l.status===401?b.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:()=>{p.push("/")}}):l.status===404?n.error("报告文件不存在"):n.error("下载报告失败，请重试")}).catch(l=>{n({message:"下载报告失败，请重试",type:"error"}),console.error(l)})};return(a,l)=>{const e=c("el-table-column"),r=c("el-tag"),m=c("el-descriptions-item"),f=c("el-descriptions"),u=c("el-button"),D=c("el-popover"),N=c("el-col"),L=c("el-row"),V=c("el-popconfirm"),F=c("el-table");return _(),k(x,null,[H,$("div",K,[t(F,{data:g,style:{width:"100%"},height:"500px",stripe:!0,"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266"},border:"","empty-text":"暂无数据"},{default:o(()=>[t(e,{prop:"create_time",label:"申请时间"}),t(e,{prop:"applicant",label:"申请人"}),t(e,{prop:"modelName",label:"申请发布模型"}),t(e,{prop:"status",label:"申请状态"}),t(e,{prop:"auditor",label:"审批人"}),t(e,{prop:"audition_time",label:"审批时间"}),t(e,{label:"操作",width:"460px"},{default:o(i=>[$("div",Q,[t(D,{placement:"bottom",width:500,trigger:"click"},{reference:o(()=>[t(u,{type:"info",onClick:s=>E(i.row)},{default:o(()=>[d(" 查看模型 ")]),_:2},1032,["onClick"])]),default:o(()=>[t(f,{title:I.value,column:3,direction:"vertical"},{default:o(()=>[t(m,{label:"使用模块",span:3},{default:o(()=>[(_(!0),k(x,null,T(M.value,s=>(_(),y(r,{size:"small"},{default:o(()=>[d(B(s),1)]),_:2},1024))),256))]),_:1}),t(m,{label:"算法参数",span:3},{default:o(()=>[(_(!0),k(x,null,T(w.value,s=>(_(),k("div",null,B(s.模块名)+": "+B(s.算法),1))),256))]),_:1})]),_:1},8,["title"])]),_:2},1024),t(V,{title:"你确定要删除该条申请吗?",onConfirm:s=>R(i.$index,i.row)},{reference:o(()=>[t(u,{type:"danger",style:{"max-width":"100px"}},{default:o(()=>[d("删除")]),_:1})]),actions:o(({confirm:s,cancel:P})=>[t(L,null,{default:o(()=>[t(N,{span:12},{default:o(()=>[t(u,{size:"small",onClick:P},{default:o(()=>[d("取消")]),_:2},1032,["onClick"])]),_:2},1024),t(N,{span:12},{default:o(()=>[t(u,{type:"primary",size:"small",onClick:s},{default:o(()=>[d(" 确定 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onConfirm"]),i.row.status==="未处理"?(_(),y(u,{key:0,type:"success",onClick:s=>j(i.$index,i.row)},{default:o(()=>[d("通过")]),_:2},1032,["onClick"])):A("",!0),i.row.status==="未处理"?(_(),y(u,{key:1,type:"warning",onClick:s=>q(i.$index,i.row)},{default:o(()=>[d("不通过")]),_:2},1032,["onClick"])):A("",!0),t(u,{size:"large",type:"text",onClick:s=>z(i.row.model_id)},{default:o(()=>[d(" 下载测试报告 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])],64)}}});export{Z as default};
