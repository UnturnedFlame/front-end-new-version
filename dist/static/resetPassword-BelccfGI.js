import{_ as T,r as v,a as y,l as q,n as d,c as t,w as l,s as _,f as F,u as B,j as b,as as w,E as i,b as c,o as u,i as z,p as M,k as $}from"./index-BeHN7UMk.js";const j=g=>(M("data-v-df84ae0d"),g=g(),$(),g),K={class:"resetPassword"},L={key:0,class:"container"},G={key:0,class:"common_div"},H={key:1,class:"common_div"},J={key:2,class:"common_div"},O={class:"common_div"},Q={key:1,class:"container"},W=j(()=>F("div",{style:{height:"100px",width:"500px","font-size":"20px","text-align":"center"}},"密码修改成功！",-1)),E=0,X=1,Y=2,R={__name:"resetPassword",setup(g){const x=v(null),S=B(),o=v(E),s=y({username:"",email:""}),m=y({code:""}),n=y({password:"",confirmPassword:""}),k={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,max:20,message:"长度在 8 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,20}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"长度在 3 到 15 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]},{pattern:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"邮箱格式不正确",trigger:"blur"}]},D=v(!1);q(()=>{});const U=()=>((s.username===""||s.email==="")&&(s.username===""?i.warning("用户名未输入"):i.warning("邮箱未输入")),!0);let A,C;const N=V=>{if(o.value===E)U()&&V.validate().then(()=>{D.value=!0;let e=new FormData;e.append("username",s.username),e.append("email",s.email),b.post("/resetPassword/send_captcha/",e).then(a=>{a.data.code===200?(o.value++,w({title:"成功",message:"验证码发送成功！",type:"success"})):a.data.code===400&&i.error(a.data.message)}),w.info({title:"提示",message:"数据正确发送，请耐心等待，勿重复操作！"})});else if(o.value===X){if(m.code===""){i.warning("验证码未输入");return}let e=new FormData;e.append("captcha",m.code),e.append("email",s.email),b.post("/resetPassword/check_captcha/",e).then(a=>{a.data.code===200?(o.value++,w({title:"成功",message:"验证码匹配正确！",type:"success"})):a.data.code===400&&i.error(a.data.message)}).catch(a=>{i.error("验证码错误！")})}else if(o.value===Y){if(n.password===""){i.warning("新密码未输入");return}if(n.confirmPassword!==n.password){i.warning("两次密码不一致");return}let e=new FormData;e.append("email",s.email),e.append("password",n.password),b.post("/resetPassword/reset_password/",e).then(a=>{a.data.code===200?(w({title:"成功",message:"该账号密码修改正确！",type:"success"}),o.value++):a.data.code===400&&i.error(a.data.message)}).catch(a=>{i.error("请求失败，请重试")})}},Z=()=>{S.push("/")};return(V,e)=>{const a=c("el-step"),I=c("el-steps"),p=c("el-input"),f=c("el-form-item"),h=c("el-form"),P=c("el-button");return u(),d("div",K,[o.value==0||o.value==1||o.value==2?(u(),d("div",L,[t(I,{active:o.value,space:200,"finish-status":"success","align-center":""},{default:l(()=>[t(a,{title:"验证用户名和邮箱",icon:"EditPen"}),t(a,{title:"输入验证码",icon:"Promotion"}),t(a,{title:"设置新密码",icon:"Key"})]),_:1},8,["active"]),o.value===0?(u(),d("div",G,[t(h,{model:s,rules:k,ref_key:"formRef",ref:x,class:"user-container","label-position":"left","label-width":"70px",size:"default"},{default:l(()=>[t(f,{prop:"username",style:{float:"right",width:"80%"},label:"用户名"},{default:l(()=>[t(p,{type:"text",modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=r=>s.username=r),autofocus:"",ref_key:"username",ref:A,"auto-complete":"off",placeholder:"请输入要找回密码的用户名","prefix-icon":"User",spellcheck:"false"},null,8,["modelValue"])]),_:1}),t(f,{prop:"email",style:{float:"right",width:"80%"},label:"邮箱号"},{default:l(()=>[t(p,{type:"text",modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=r=>s.email=r),autofocus:"",ref_key:"email",ref:C,"auto-complete":"off",placeholder:"请输入用来找回密码的邮箱","prefix-icon":"Message",spellcheck:"false"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):_("",!0),o.value===1?(u(),d("div",H,[t(h,{model:m,class:"user-container","label-position":"left","label-width":"60px",size:"default"},{default:l(()=>[t(f,{style:{float:"right",width:"80%"},label:"验证码"},{default:l(()=>[t(p,{type:"text",modelValue:m.code,"onUpdate:modelValue":e[2]||(e[2]=r=>m.code=r),autofocus:"",ref:"code","auto-complete":"off",placeholder:"请输入邮箱验证码","prefix-icon":"el-icon-s-promotion",spellcheck:"false"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):_("",!0),o.value===2?(u(),d("div",J,[t(h,{model:n,rules:k,class:"user-container","label-position":"left","label-width":"90px",size:"default"},{default:l(()=>[t(f,{prop:"password",style:{float:"right",width:"80%"},label:"新密码"},{default:l(()=>[t(p,{type:"password",modelValue:n.password,"onUpdate:modelValue":e[3]||(e[3]=r=>n.password=r),autofocus:"",ref:"password","auto-complete":"off",placeholder:"请输入新密码","prefix-icon":"el-icon-key"},null,8,["modelValue"])]),_:1}),t(f,{style:{float:"right",width:"80%"},label:"确认新密码"},{default:l(()=>[t(p,{type:"password",modelValue:n.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=r=>n.confirmPassword=r),ref:"confirmPassword","auto-complete":"off",placeholder:"请再次输入新密码","prefix-icon":"el-icon-key"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):_("",!0),F("div",O,[t(P,{onClick:e[5]||(e[5]=r=>N(x.value)),disabled:!1,class:"action_button"},{default:l(()=>[z("下一步")]),_:1})])])):_("",!0),o.value==3?(u(),d("div",Q,[W,t(P,{onClick:Z,type:"success",style:{"text-align":"center",width:"30%","margin-left":"170px","font-size":"large",color:"white"}},{default:l(()=>[z("返回登录界面")]),_:1})])):_("",!0)])}}},te=T(R,[["__scopeId","data-v-df84ae0d"]]);export{te as default};
