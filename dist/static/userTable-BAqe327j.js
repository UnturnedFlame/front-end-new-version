import{r as h,a as S,l as W,n as G,f as d,c as e,w as t,F as H,u as I,j as y,x as p,B as K,E as m,b as s,o as Q,i}from"./index-BeHN7UMk.js";const X=d("div",{class:"shadow-border title-container"},"用户账号管理",-1),Y={class:"roleManage"},ee={class:"tableTool",style:{position:"relative",width:"100%",height:"30px"}},te={style:{position:"absolute",right:"12%",display:"flex","flex-direction":"row"}},le={style:{display:"flex","flex-direction":"row","margin-right":"20px"}},ae={style:{display:"flex","flex-direction":"row","margin-right":"20px"}},oe=d("span",{style:{width:"100px",display:"flex","align-items":"center","justify-content":"center"}},"选择关键字",-1),re={class:"table-container"},se={style:{display:"flex"}},ne={class:"button-container"},ie={class:"buttons-right-bottom"},v="140px",me={__name:"userTable",setup(de){const c=I(),j=h("jobnumber"),N=h(""),F=()=>{y.get("administration/search_user/?keywords="+N.value+"&keywordType="+j.value).then(o=>{if(o.data.code==401)p.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:l=>{c.push("/")}});else if(o.data.code==200){f.value.length=0;for(let l of o.data.result)f.value.push(l)}}).catch(o=>{K.error("搜索失败，请重试")})},f=h([]),M=(o,l)=>{y.get("administration/delete_user/?jobNumber="+l.jobNumber).then(r=>{r.data.message==="user deleted success"?(console.log("删除成功：",r.data),f.value.splice(o,1),m({message:"用户删除成功",type:"success"})):r.data.code==401&&p.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:w=>{c.push("/")}})}).catch(r=>{m.error("删除失败，请稍后重试")})},q=(o,l)=>{y.get("/administration/reset_user_password/?jobNumber="+l.jobNumber).then(r=>{r.data.code===200?(z(),p.alert(r.data.message,"提示",{confirmButtonText:"确认"})):r.data.code==401&&p.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:w=>{c.push("/")}})}).catch(r=>{m.error("密码重置失败，请稍后重试")})},z=async()=>{try{y.get("/administration/fetch_users_info/").then(o=>{o.data.code===401?p.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:l=>{c.push("/")}}):f.value=o.data})}catch{m({message:"获取用户信息失败，请稍后重试",type:"error"})}},x=h(null),_=h(!1),n=S({username:"",password:"",role:"user",jobNumber:"",email:""}),A={username:[{required:!0,message:"用户姓名不能为空",trigger:"blur"},{min:3,max:10,message:"用户姓名长度必须在3到10个字符之间",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:8,message:"密码长度必须至少为8位",trigger:"blur"},{pattern:/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).+$/,message:"密码必须包含数字、大小写字母",trigger:"blur"}],jobNumber:[{required:!0,message:"工号不能为空",trigger:"blur"},{min:5,max:10,message:"工号长度必须在5到10个字符之间",trigger:"blur"},{pattern:/^\d{5,10}$/,message:"工号必须为5到10位数字",trigger:"blur"}],email:[{required:!1,message:"邮箱不能为空",trigger:"blur"},{pattern:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"邮箱格式不正确",trigger:"blur"}]},R=o=>{o&&(o.resetFields(),_.value=!1,c.push("/admin/userManage"))},Z=async()=>{try{if(await x.value.validate()){let l=JSON.stringify(n);y.post("/administration/add_user/",l).then(r=>{r.data.message==="add user success"?(m({message:"用户创建成功",type:"success"}),x.value.resetFields(),_.value=!1,z()):(r.data.code==401&&p.alert("登录状态已失效，请重新登陆","提示",{confirmButtonText:"确定",callback:w=>{c.push("/")}}),m({message:"用户创建失败,"+r.data.message,type:"error"}))}).catch(r=>{console.error("请求错误：",r),m.error("服务器出错，请稍微重试")})}else{console.error("表单验证失败");return}}catch(o){console.error("创建用户失败",o)}};return W(()=>{z()}),(o,l)=>{const r=s("a-select-option"),w=s("a-select"),D=s("a-input"),E=s("a-button"),u=s("el-button"),k=s("el-table-column"),V=s("el-col"),B=s("el-row"),$=s("el-popconfirm"),P=s("el-table"),C=s("el-input"),b=s("el-form-item"),U=s("el-radio"),J=s("el-radio-group"),L=s("el-form"),O=s("el-dialog");return Q(),G(H,null,[X,d("div",Y,[d("div",ee,[d("div",te,[d("span",le,[d("div",ae,[oe,e(w,{style:{width:"110px"},value:j.value,"onUpdate:value":l[0]||(l[0]=a=>j.value=a)},{default:t(()=>[e(r,{value:"username"},{default:t(()=>[i("用户名")]),_:1}),e(r,{value:"jobnumber"},{default:t(()=>[i("工号")]),_:1})]),_:1},8,["value"])]),e(D,{value:N.value,"onUpdate:value":l[1]||(l[1]=a=>N.value=a),placeholder:"按关键字搜索"},null,8,["value"]),e(E,{onClick:F},{default:t(()=>[i("搜索")]),_:1})]),e(u,{onClick:l[2]||(l[2]=a=>_.value=!0),style:{width:"120px",border:"none"},icon:"Plus",color:"green"},{default:t(()=>[i(" 新增用户 ")]),_:1})])])]),d("div",re,[e(P,{data:f.value,style:{width:"100%"},height:"500px",stripe:!0,"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266"},border:"","empty-text":"暂无数据"},{default:t(()=>[e(k,{prop:"jobNumber",label:"工号"}),e(k,{prop:"username",label:"用户名"}),e(k,{prop:"email",label:"邮箱"}),e(k,{label:"操作"},{default:t(a=>[d("div",se,[e($,{title:"你确定要删除该用户吗?",onConfirm:g=>M(a.$index,a.row),width:"100px"},{reference:t(()=>[e(u,{size:"small",type:"danger",style:{width:"100px","margin-right":"20px"}},{default:t(()=>[i("删除")]),_:1})]),actions:t(({confirm:g,cancel:T})=>[e(B,null,{default:t(()=>[e(V,{span:12},{default:t(()=>[e(u,{size:"small",onClick:T},{default:t(()=>[i("取消")]),_:2},1032,["onClick"])]),_:2},1024),e(V,{span:12},{default:t(()=>[e(u,{type:"primary",size:"small",onClick:g},{default:t(()=>[i(" 确定 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onConfirm"]),e($,{title:"你确定要重置该用户的密码吗?",onConfirm:g=>q(a.$index,a.row),width:"100px"},{reference:t(()=>[e(u,{size:"small",type:"primary",style:{width:"100px"}},{default:t(()=>[i("重置密码")]),_:1})]),actions:t(({confirm:g,cancel:T})=>[e(B,null,{default:t(()=>[e(V,{span:12},{default:t(()=>[e(u,{size:"small",onClick:T},{default:t(()=>[i("取消")]),_:2},1032,["onClick"])]),_:2},1024),e(V,{span:12},{default:t(()=>[e(u,{type:"primary",size:"small",onClick:g},{default:t(()=>[i(" 确定 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onConfirm"])])]),_:1})]),_:1},8,["data"])]),e(O,{modelValue:_.value,"onUpdate:modelValue":l[10]||(l[10]=a=>_.value=a),title:"新增用户",width:"500",onClose:l[11]||(l[11]=()=>{n.username="",n.password=""}),"show-close":!1,"close-on-click-modal":!1,center:""},{footer:t(()=>[d("div",ne,[d("div",ie,[e(u,{onClick:l[8]||(l[8]=a=>R(x.value))},{default:t(()=>[i("取消")]),_:1}),e(u,{type:"primary",onClick:l[9]||(l[9]=a=>Z())},{default:t(()=>[i("确定")]),_:1})])])]),default:t(()=>[e(L,{model:n,rules:A,ref_key:"formRef",ref:x,style:{"margin-right":"70px"}},{default:t(()=>[e(b,{prop:"jobNumber",label:"工号","label-width":v},{default:t(()=>[e(C,{modelValue:n.jobNumber,"onUpdate:modelValue":l[3]||(l[3]=a=>n.jobNumber=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(b,{prop:"username",label:"用户名","label-width":v},{default:t(()=>[e(C,{modelValue:n.username,"onUpdate:modelValue":l[4]||(l[4]=a=>n.username=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(b,{prop:"password",label:"密码","label-width":v},{default:t(()=>[e(C,{modelValue:n.password,"onUpdate:modelValue":l[5]||(l[5]=a=>n.password=a),autocomplete:"off",placeholder:"密码须包含数字以及大小写字母"},null,8,["modelValue"])]),_:1}),e(b,{prop:"email",label:"邮箱","label-width":v},{default:t(()=>[e(C,{modelValue:n.email,"onUpdate:modelValue":l[6]||(l[6]=a=>n.email=a),autocomplete:"off",placeholder:"请输入邮箱（可选）"},null,8,["modelValue"])]),_:1}),e(b,{prop:"role",label:"角色权限","label-width":v},{default:t(()=>[e(J,{modelValue:n.role,"onUpdate:modelValue":l[7]||(l[7]=a=>n.role=a),style:{"padding-left":"10px"}},{default:t(()=>[e(U,{label:"user",size:"large"},{default:t(()=>[i("普通用户")]),_:1}),e(U,{label:"superuser",size:"large"},{default:t(()=>[i("开发者用户")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{me as default};
